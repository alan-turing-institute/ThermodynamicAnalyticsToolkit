#!/usr/bin/env @PYTHON@

import sys, getopt
sys.path.insert(1, '@pythondir@')

import tensorflow as tf
import numpy as np

from DataDrivenSampler.common import get_filename_from_fullpath
from DataDrivenSampler.DataOptimizer import parse_parameters
from DataDrivenSampler.models.model import model
from DataDrivenSampler.version import get_package_version, get_build_hash

FLAGS = None

def main(_):
    network_model = model(FLAGS)

    network_model.init_network(FLAGS.restore_model, setup="train")

    network_model.train()

    network_model.finish()

if __name__ == '__main__':
    FLAGS, unparsed = parse_parameters()

    if FLAGS.version:
        # give version and exit
        print(get_filename_from_fullpath(sys.argv[0])+" "+get_package_version()+" -- version "+get_build_hash())
        sys.exit(0)

    print("Using parameters: "+str(FLAGS))

    if len(unparsed) != 0:
        print("There are unparsed parameters '"+str(unparsed)+"', have you misspelled some?")
        sys.exit(255)

    tf.app.run(main=main, argv=[sys.argv[0]] + unparsed)

